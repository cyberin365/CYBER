## OSI Model
- physical
	- electrical (copper twisted pair), light (fiber optic mmf or smf), or radio waves (wireless 2.4ghz or 5ghz)
	- hubs and repeaters
	- testing cables
	- loopback tests on NICs
	- PDU: bit
- data link
	- network cards, ethernet adapters, wifi adapters
	- PDU: frame (add source and dest mac address)
	- functions
		- flow control - simple pause
		- error detection - cyclic redundnacy check (crc). if fail, just discard, doesnt request retransmission
		- de-multiplex between ipv4 or ipv6 packet, direct to correct protocol handler
	- MAC addresses
		- 48 bit
		- only for devices on ethernet/wifi
		- only affects how a device is seen by other devices on same local network
	- EUI-48/EUI-64
		- any object including bluetooth and even software
		- *first 3 bytes / first 24 bits = manufacturer*
		- *last 3 bytes / last 24 bits = assigned by manufacturer* 
- network
	- routers
	- PDU: packet (add ip addresses)
	- functions
		- fragmentation - if exceeds maximum transmission unit (mtu)
	- protocols
		- IP - main protocol. connectionless
		- ICMP - error messages, like ping
		- ARP - address resolution protocol. turns ip addresses on same network into mac addresses.
- transport
	- protocol: tcp or udp
	- PDU: segment (tcp) datagram (udp) 
	- functions
		- flow control - sliding window protocol - telling sender to adjust transmission rate accordingly
		- error detection - tcp. checksum and ACKs. if fail, request a retransmit
		- multiplexing (adding port numbers on way out to router) and demultiplexing (direct data to right application based on port)
- session
	- controls when communication starts, stops, ends
	- modern: most functions have been absorbed into application and transport layer
	- misc functions:
		- checkpointing in large downloads
		- maintains state after authentication so dont have to re-login on every page, session stays open
- presentation 
	- ​puts data into format for application
		- character encoding
		- application encryption
	- layer where encryption and decryption occur (examples: SSL, TLS, HTTPS)
	- layer where compression and decompression occur
- application layer
	- many protocols: HTTP, FTP, DNS, POP3, etc

## Networking Devices
- Outoing traffic:
	- Client -> forward proxy -> firewall -> IDS/IPS -> router -> internet
	- Server -> load balancer -> IDS/IPS -> firewall -> router -> internet
- Incoming traffic:
	- Internet -> router -> firewall -> IPS/IDS -> load balancer -> server
- Firewall
	- traditional works by TCP or UDP port
	- NGFW (next generation firewall) - firewalls by application. 2 firewalls can create an encypted tunnel between eahc other via VPN
		- most firewalls can also be layer 3 devices AKA router.
- Load balancer
	- TCP offload - instead of asking servers to do administrative work of TCP syn, synack, ack, the load balancer does it iself
	- SSL offload - instead of asking servers to do encryption and decryption of SSL/TSL, load balancer does it itself
	- Caching - frequent request arent sent to servers (like static content), but cached at the load balancer itself for quick responses
	- QoS - prioritizing certain traffic over others (either based on source or traffic type)
	- Content Switching - load balancer keeps track of which content is on which server. ex all image requests go to server A, all database queries go to server B.
- Proxies
	- for outgoing requests, perform a request on behalf othe client. 
	- cache results from the internet
	- url filtering and content scanning to block some content from the user
- Network Attached Storage (NAS)
	- file-level access - if you want to edit a file, need to download whole file to client, the write whole file back
- Storage Area Netowkr (SAN)
	- block-level access - only need to edit certain blocks
- Access points
	- translates between 802.3 ethernet and 802.11 wifi
	- wireless LAN controller - manages all WAPs centrally, has performance and security monitoring, can deploy changes to all WAPs at once

## Networking Functions
- Content Delivery Network (CDN)
	- geographically distributed caches of duplicated data.
- VPN
	- encrypted communication across a insecure public network
	- concentrator - encryption/decryption device. sometimes separate hardware, sometimes built into firewall
- QoS
	- prioritize traffic by application (voice call over file download), or user
	- can be done at firewall, router, or switch
- TTL time to live
	- ipv4 TTL - prevents inadvertent router loop
		- *macos/linux default 64 hops*
		- *windows default 128 hops*
		- for most internet, need about 12-16 hops, so safe limit
	- DNS TTL - DNS tells your computer how long to keep this DNS lookup record


![Pasted image 20250901182152](Pasted%20image%2020250901182152.png)
## ipv4 header
- version - always 4
- *header length - min 5 (i.e. 20 bytes), max 15 (i.e. 60 bytes)*
- QoS type
- total packet length
- identification - this is a fragment from original IP packet N
- flags - dont fragment / more fragments indicators
- fragment offset - position of this fragment relative to original IP packet
- time to live - prevent looping
- *protocol - 6 for tcp, 17 for udp*
- header checksum - error detection. if this fails, discards the packet
- source and destination IP

## Cloud
- virtual private cloud, connected via transit gateways (like a router for cloud networks)
- vpc NAT gateway (to connect private cloud subnets to external intenret)
- vpc endpoint (connect networks on different cloud vendors)
- network security list (choose what ports, inbound/outbound, and from what ip addresses are allowed to talk to your cloud network)
- network security group (more granularity on security rules to apply to groups of subnets)
- models
	- software-as-a-service - on-demand software. no installation, just log in. 
	- HaaS/IaaS - example: web server providers. customers rent servers, but have to do OS themselves, netwroking themselves
	- PaaS - middle ground (ex. salesforce)

## Internet Protocol
- in TCP, SYN-SYNACK-ACK is performed once per session
- in UDP, no flow control. cant say "slow down"
- on server side, usually used non-epehemeral ports (i.e. HTTP is awlays 80). on client side, use temporary/ephemeral ports.
- *max port number: 65,535*
- FTP control - tcp/21
- FTP data - tcp/20
- SSH - tcp/22  (also SFTP)
- Telnet - tcp/23 (unencrypted)
- SMTP - tcp/25, or tcp/587 (TLS encrypt)
- POP3 - 
- DNS - udp/53
- DHCP - udp/67, 68
- TFTP - udp/69 (PXE - boot OS from network)
- HTTP - tcp/80
- HTTPS - tcp/443 (uses TLS or SSL)
- NTP - udp/123 
	- makes sure switch, router, firewall, servers, workstations all have same time
- SNMP 
	- udp/161
	- gather status, statistics, errors from network devices
	- v1 - 
	- v2 - added bulk transfers
	- v3 - added integrity, authentication, and ecryption
	- polling - proactive request from manager
	- traps - unprompted alerts sent to manager by devices (agents) 
	- MIB is database on agent of monitored data
	- OID - codes for each type of data on device (temperature of sensor, cpu utilization of router 3)
- LDAP
	- tcp/389, or tcp/636 (secure)
	- CN (common name AKA users) ⊆ OU (org units AKA Groups) ⊆ DC (domain component AKA organization)
	- attributes: name, user ID, email, telephone number
- SMB (server message block)
	- windows protocol
		- windows authentication (active directory)
		- access shared folders via `\\server-name\share-name` right in explorer
	- for file sharing and printer sharing over local network only, not internet
	- AKA CIFS (common internet file system)
	- old: over NetBIOS
	- modern: tcp/445
- Syslog - udp/514
	- used with SIEM
- MS-SQL - tcp/1433
- RDP (remote desktop)
	- tcp/3389
- VoIP SIP (session initiation protocol)
	- tcp/5060
	- tcp/5061

## Other Protocols
- ICMP (internet control message protocol)
	- check if a device is online `ping`
	- device reporting that network unreachable, or that time-to-live has expired
- GRE (generic routing encapsulation)
	- creating tunnel between 2 endpoints. mask the source and destination address with an intermediate point on both ends. the payload is not encrypted in any way, just the source and destination headers have been changed.
-  VPN 
	- will usually combine GRE tunneling/encapsulation with IPsec encrpytion
	- VPNs goal is to send private data over public networks
	- concentrator: standalone hadware, or software, or integrated into firewall device
- IPSec
	- encryption + digital signatures
	- IPSec is at network layer - encrypts all communication between 2 IPs, encrypts IP packets
	- TLS is transport layer - between 2 applications, encrypts data
	- 2 alternative protocols:
		- AH (authentication header) - auth and integ only
		- ESP (encapsulation security payload) - encryption + auth + integ
	- IKE (internet key exchange)
		- setting up the tunnel
		- agree on the keys (SA = security association)
		- ISAKMP: diffie-hellman to create a shared secret key
			- udp/500
		- coordinate ciphers, coordinate key sizes, negotiate inbound SA, negotiate outbound SA
		- 2 modes:
		  ![540x144](Pasted%20image%2020250901200247.png)

## Digital Signatures
- Sender: calculate `encryptAlgo(sendersPrivateKey, hashingAlgo(data)) = digitalSignature(sender,data)`
- Receiver:  if `decryptAlgo(sendersPublicKey, digitalSignature(sender,data))` = `hashingAlgo(data)`, then integrity + authenticated

## Cryptography
- Hashing Algorithms
	- for integrity only
	- MD-5. obsolete
	- SHA-1, SHA-256, SHA-512. Latter 2 are preferred today
- Symmetric Encryption
	- 3DES. outdated
	- AES. current
	- require less computational power, perferred for large file transfers
- Assymmetric Encrpytion
	- for digital signatures
	- RSA (backbone of TLS)
	- Diffie-Hellman (think IKE key exchange / VPNs / tunnels)
	- ECC (newest, better for mobile)

## Communication
- Unicast: 1-to-1
	- examples: checking email, visiting website
- Multicast: 1-to-many
	- Real-time streaming, stock exchange info
- Anycast: 1-to-one-of-many
	- instead of destination ip address, use a anycast ip address and router sends it to next closest hop
	- example: closest DNS responds, toll-free numbers
- Broadcast: 1-to-all
	- scope limited to broadcast domain
	- not used ipv6
	- destination ip address in header
		- Limited: `255.255.255.255` means send to everyone on this LAN
		- Directed: everyone on a remote network. use remote network's network ID (first half of ip), replace all host bits with `1`
			- usually blocked bc DDOS attacks

## Wireless
- 802.11 = wifi
- 4G/LTE
	- GSM and CDMA convered into 4G/LTE
	- based on GSM and EDGE
	- LTE up to 150 Mbps
	- LTE-A up to 300 Mbps
		- Mbps divided by 8 = MBps, because 8bits =1 byte
- 5G
	- max 10 GBps
	- with new speeds, many computations better to do in the cloud
- Satellite
	- used in remote locations
	- typically 100 Mbps down, 5Mbps up
	- typical latency 250 ms up, 250 ms down
	- starlink: 40ms roundtrip latency
	- CONS: requires direct line of sight to satellite, thunderstorms

## Ethernet
- 802.3
- Twisted-pair copper or Fiber Optic
- Fiber optic
	- pros
		- more secure than copper, because can't tap
		- >100m better, signal doesnt degrade
		- light has no RF interference
		- MMF - less than 2km
		- SMF - to up 100km
	- connectors
		- SC / square / simple push-pull / commonly in pairs, one transmit one receive
		- LC / smaller / clip lock / also in pairs
		- ST / bayonet twist / 
		- MPO (multifiber) 12 fibers in 1 cable
- Twsited pair
	- each pair has a different twist rate
	- differential signaling `("positive version of signal" + noise) - ("negative version of signal" + same noise) = "original undistorted signal"`
	- common mode signal: twisting is what makes sure the noise on both cables is equal, because neither is closer to the EMI
	- each pair twisted at different rates. why? if they were all twisted at same rate, the EM fields generated by the cables themselves would bleed into each other, with synchronized peaks and troughs on voltage.
	- connectors
		- RJ-11 - 6p2c - has space for 6 wires, but only uses 2.
		- RJ-45 - 8p8c 
- Co-axial
	- twinaxial cable
		- 2 inner conductors, 1 for transmit, 1 for receive
		- pros
			- faster than coax
			- less latency than fiber optic (bc no conversion between light and EM)
			- cheaper than fiber optic
		- cons:
			- only 5m
	- Connector
		- F. (threaded)
		- BNC (bayonet)
- Plenum
	- shared airspace above the drop-ceiling.
	- 2 materials: Teflon/FEP, and low-smoke PVC (less common, less effective)
	- usually less flexible

| Name | Colloquial Name | Speed | Cable | Light Source |
| :--- | :--- | :--- | :--- | :--- |
| **Twisted-Pair (Copper)** | | | | |
| 10BASE-T | Ethernet | 10 Mbps | Cat3 or higher | N/A |
| 100BASE-TX | Fast Ethernet | 100 Mbps | Cat5 or higher | N/A |
| 1000BASE-T | Gigabit Ethernet | 1 Gbps | Cat5e or higher | N/A |
| 10GBASE-T | 10 Gigabit Ethernet | 10 Gbps | Cat6 (55m), Cat6A (100m) | N/A |
| **Fiber Optic** | | | | |
| 100BASE-FX | Fast Ethernet | 100 Mbps | Multimode Fiber (MMF) | LED |
| 1000BASE-SX | Gigabit Ethernet | 1 Gbps | Multimode Fiber (MMF) | Short-wavelength laser |
| 1000BASE-LX | Gigabit Ethernet | 1 Gbps | MMF or Single-mode Fiber (SMF) | Long-wavelength laser |
| 10GBASE-SR | 10 Gigabit Ethernet | 10 Gbps | MMF | Short-range laser |
| 10GBASE-LR | 10 Gigabit Ethernet | 10 Gbps | SMF | Long-range laser |

## Transceivers
- sits between the cable and the transceiver port on the switch.
- job is to convert signals (usually light from fiber optic, and EM fro mcopper)
- types
	- SFP - 1 gigabits
	- SFP+ - 16 gigabits
	- QSFP and QSFP+ - 4 separate signals
		- the transceiver has 4 separate lasers, and a multiplexer to combine the 4 wavelegnths into a single beam

## Topologies
- Star / Hub and Spoke
	- example. switched ethernet
- Mesh - multiple paths to get to destination
	- used in WANs
	- more fault-tolerant bc no single center
	- can also do load balancing. split data over diff paths
- Spine and Leaf
	- each spine connects to every leaf
	- each leaf connects to every spine
	- every device connects to 1 leaf
	- top-of-rack-switching (top of each rack has a leaf switch)
	- this design ensures youre no more than 1 switch away from any other leaf
	- this design is bad data center gets very large
- Point to Point
	- older T1 and T3
- three-tier
	- core - web servers, databases
	- distribution - switches
	- access - end stations, printers
	- main downside is even if 2 severs are on same rack, might have to travel all the way up and all the way back down
	- collapsed core - no middle distribution layer
- traffic flows
	- east-west means between 2 devices in the same data center
	- north-south means incoming/outgoing from data center

## IPv4
- default gateway - the local IP address of your router
- loopback address - 127.x.x.x. usually ping yourself at 127.0.0.1
- reserved addresses
	- [240-254].x.x.x
	- all class E addresses
- virtual IP addresses- not a physical NIC, but something like a virtual machine
- APIPA - 129.254.x.y
	- x cannot be 0 or 255
- NAT - how your router translates between private and public IPs
- multicast addresses
	- send data to the multicast address
	- devices who want to receive data use IGMP protocol to tell the router "I want to subscribe to that group". even routers outside the subnet can subscribe via PIM (think of distribution tree)
- broadcast address
	- highest possible host value (i.e. x.x.255.255, or x.255.255.255)


| **Class**     | **first 4 binary bits** | **first decimal byte** | **Subnet Mask**      | **Network/Host bits**    | **Private range** |
| ------------- | ----------------------- | ---------------------- | -------------------- | ------------------------ | ----------------- |
| A             | 0xxx                    | [0-127].x.x.x          | 255.0.0.0 or /8      | 8/24                     | 10.x.x.x          |
| B             | 10xx                    | [128-191].x.x.x        | 255.255.0.0 or /16   | 16/16                    | 172.[16-31].x.x   |
| C             | 110x                    | [192-223].x.x.x        | 255.255.255.0 or /24 | 24/8                     | 192.168.x.x       |
| D (multicast) | 1110                    | [224-239].x.x.x        |                      | all 32 bits define group |                   |
| E (reserved)  | 1111                    | [240-255].x.x.x        |                      |                          |                   |

- CIDR
	- subnetting without typical class A B and C.
	- since subnet mask is always 1s followed by 0s, can just write how many 1s
		- example. These all mean the same subnet
			- binary subnet mask: `11111111.11110000.00000000.00000000`
			- CIDR subnet mask: `/12`
			- simple explanation: 12 network bits, 20 host bits
			- decimal subnet mask: `255.240.0.0`

## LAN, VLAN, SDWAN
- VLAN
	- Layer 2 / Data layer / MAC address layer
	- 12bit ID, therefore max 4094 possible VLANs
	- subnets are at layer 3, while vlans are at layer 2 and create broadcast domains, however in practice there is usually a 1-1 relationship between vlans and subnets
	- When a frame needs to be sent across a Trunk Port (link between switches for VLANs), an 802.1Q tag is added before trunk port, then stripped off before frame delivered to end device
- VXLAN
	- Layer 3 / Network layer / IP address layer
	- encapsulates layer 2 frames inside a layer 3 UDP packet
	  ![[image-3.png|456x103]]
	- 24bit ID (called VNI) therefore 16 million IDs possible
	- Used for DCI (Data center interconnect)
	- mostly used to solve the scalability issues of VLANs
- SDWAN
	- for geographically distributed offices and users
	- put into a single network in the cloud

## Zero Trust
- every user/device/application, even inside the network must be verified
- Policy-based authentication (who are you?)
	- Adapts to situation
		- long employee / new vendor
		- inside building / IP address another country
		- unusual time of day
	- decide: grant, deny, revoke
- Authorization (what kind of access?)
	- Least privilege access
- SASE (secure access service edge)
	- cloud-based security for SDWANs software defined wans

## Infrastructuer as Code (IaC)
- a configuration file that can describe our infrastructure
- instructions to the cloud on how to build our network
- Playbook
	- series of re-usable steps to do network admin tasks (investigate a data breach, recover from randsomeware, etc)
	- third party SOAR platforms (security orchestration automation and response)
- Advantages
	- configuration drift 
	- easy testing environments
	- version control of config files
	- many people can work on their part of the code (branching)
		- ways to manage merge conflicts

## IPv6
- 32bit/4bytes --> 128bit/16bytes
- basics:
	- 8 bits = 1 byte
	- 4 bits = 1 hexadecimal char
		- therefore 2 hexadecimals = 1 byte
		- therefore 32 hexadecimals = 16 bytes = ipv6 address
- communicate w ipv4
	- tunnel - encapsulate one inside another
		- 6in4 - cons: requires relay routers. no support for NAT
		- 4in6 - 
	- dual stack -  device can communicate in both.
		- application decides which to use. 
		- NAT64-capable router and DNS64 server
	- translate - convert
- Routing tables
	- tables mapping destination IPs to next hop router ip address
	-  static tables 
		- good for smaller networks, stub networks, no CPU/memory/bandwidth overhead
		- bad for large networks, network changes, human error routing loops
	- dynamic routing
		- routers send routes to each other automatically. requires more router overhead (EIGRP updates)
		- in reality, your home router doesnt have most of hte internets IP addresses on its routing table, so it will send the packet to your default gateway, which is your ISP, which has huge routing tables
		- routing protocols
			- distance-vector: only knows total hops to destination and next-hop
			- link-state: every router knows full topology
			- RIP
				- simple distance-vector
				- limited to 15 hops
				- slow voncergence
				- obsolete
			- EIGRP
				- CISCO proprietary
				- advanced version of distance-vector, not a full 100% topoogy
				- fast convergence
				- no loops
				- easy to set up
				- hybrid: based on both distance and link-state
				- load balances even over higher cost routes
			- OSPF
				- common for interior networks
				- link-state
				- usually used when you have complete control of all systems (AS autonomous system)
				- available on all routers
				- best route determined by the "cost" which is the level of bandwidth between routers 
				- can load balance between equal cost routes
			- BGP
				- used on exterior networks, like the www
				- path-vector
				- three-napkins protocol
				- path-vector protocol - routing decisions are based on policies and a long list of attributes
	- entry fields
		- ![[image.png]]
		- administrative distance - score based on what protocol added entry to routing table
			- if multiple entries which match, choose the most specific (i.e. longest subnet mask bc longest matching prefix)
			- local (0) < static route (1)  < EIGRP (90) < OSPF (110) < RIP (12) < DHCP default route (254)
		- routing metrics cannot be compared across protocols, but always choose the lower of 2. 
		- timer is how long since this route has been added
		- last field is egress interface - the physical port to leave the router
	- first hop redudnancy protocol (FHRP)
		- what happens if primary router fails? set default gateway to a virtual IP which can be switched from 1 physical router to another
	- subinterface
		- an interface is just the representation of a port on the switch's software
		- usually exists between a router and a switch.
		- notation usually looks like: `interface 0/0.1`, `interface 0/0.2`, `interface0/0.3`
		- each vlan has a different default gateway. but in reality, they should all go to the same router. so to avoid having separate port/interfaces 1 per default gateway, just split up the port/interface on the router into subinterfaces.
- NAT network address translation
	- PAT (aka NAT overload) just add a port per device on internal network
- LAN 
	- group of devices on the same broadcast domain / connected to same switch
	- VLAN trunking
		- 802.1Q
		- single ethernet cable to connect 2 switches. now vlans on different switches can be part of the same VLAN
		-  ![[image-1.png|521x132]]
		- VLAN tag is 12 bits long
		- obsolete version is ISL
	- default VLAN
		- every port on the switch is on this VLAN 1 by default
	- native VLAN
		- if sent without a VLAN tag, the 802.1Q trunk 
	- switched virtual interfaces
		- if switch and router are combined within the same physical device (AKA layer 3 switch), need a way to simulate the multiple interfaces/ports that would have existed between the router and switch which would have been necessary to create inter-VLAN routing
- Voice and Data
	- voice needs more consistent data stream
	- voice and data re usually separated into separate VLANs
	- usually connect computer -->VoIP phone --> switch, because phone has an internal switch that says to forward all traffic without a VLAN tag. all data generated by phone itself has VLAN for voice traffic tagged onto it. "pass-trhough" function 

## Interface Configurations
- ethernet: 
	- speed: 10mb/100mb/1gb/10gb
		- must be the same on the computer and switch side. often set automatically
		- wont work at all if mismatch
	- duplex: half/full 
		- also set automatically
		- will worth if mismatched,  but poorly
	- ip address management configuration
		- VLAN interfaces
		- ip address
		- subnet mask
		- default gateway

## OSI review
- layer 7,6,5 - data
- layer 4 - transport (PDU: segment (tcp) / datagram (udp))
	- source port
	- destination port
	- sequence/acknowledgment
		- if sender to receiver: sequence (to re-assemble data in right order)
		- if receiver to sender: acknowledgement (this is what i received up to so far. send the next one)
	- flags
		- SYN, ACK, FIN (finish), RST (reset), PSH (push), URG (urgent)
	- window size
		- receiver telling sender how much it can accept to prevent overflowing
- layer 3 - network layer (PDU - packet) 
	- version (4/6)
	- header length
	- total packet length
	- ToS/QoS
	- identification/flags/fragment offset (3 fields used for fragmentation)
	- source ip
	- destination IP
	- TTL
	- protocol (tcp/udp)
	- header checksum
- layer 2 - data link layer / MAC